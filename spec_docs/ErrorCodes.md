
---

## 2. `ErrorCodes.md`

```markdown
# Error Codes for TS-1388 Parser

„анный документ описывает коды ошибок, используемые в парсере TS-1388.  
ЉаждаЯ функциЯ парсинга P_XXX при завершении должна вернуть один из этих кодов и установить ParamErrorCode(i).

---

## 0 С OK

**Ћписание:**  
Џараметр успешно обработан.

**‚арианты:**
- обЯзательный параметр найден, проверен, заменЮн токеном;
- опциональный параметр не найден, но это разрешено логикой (например, значение `-` или полностью отсутствует), и функциЯ считает такой случай штатным.

---

## 1 С PARAM_NOT_FOUND

**Ћписание:**  
Џараметр не найден там, где он ожидаетсЯ.

**’ипичные случаи:**
- в соответствующем сегменте строки вместо значениЯ С нечто иное;
- выражение не соответствует допустимому шаблону;
- сегмент содержит только `-` при условии, что параметр обЯзателен.

**„ействиЯ:**
- `ParamStart(i) = 0`
- `ParamEnd(i) = 0`
- `ParamValue(i) = ""`
- `ParamErrorCode(i) = 1`

---

## 2 С MALFORMED_VALUE

**Ћписание:**  
Џараметр найден, но его значение синтаксически некорректно или не соответствует правилам.

**Џримеры:**
- диапазон температур: `-6O...+200` (буква O вместо цифры 0);
- диапазон: `+200...-50` (перепутаны местами LOW и HIGH);
- длина `10--->9` (некорректное обозначение, если оно не разрешено ’‡);
- исполнение `BG2` без корректного префикса A/EX/Ђ‚/EX‚ и т.п.;
- неизвестный тип датчика, не входЯщий в список поддерживаемых (например, `PT999`).

**„ействиЯ:**
- ParamStart/ParamEnd указывают на проблемный фрагмент;
- ParamValue(i) содержит исходное значение;
- ParamErrorCode(i) = 2.

---

## 3 С ERR_FOUND_NOT_CLEANED

**Ћписание:**  
Џараметр найден и распознан, но исходный фрагмент не заменЮн токеном в WorkString.

€спользуетсЯ как служебнаЯ ошибка длЯ контролЯ функции `ReplaceParam`.

**“словиЯ:**
- `ParamStart(i) > 0`
- `ParamEnd(i) > 0`
- `ParamValue(i) <> ""`
- но в WorkString фрагмент исходного текста всЮ ещЮ присутствует (или токен установлен некорректно).

**Ќазначение:**
- поиск несоответствий между логикой поиска и логикой замены;
- проверка корректности всех вызовов ReplaceParam.

---

## 4 С RANGE_ERROR

**Ћписание:**  
—исловое значение параметра находитсЯ вне допустимого диапазона.

**Џримеры:**
- P_T_LOW < -200 или > P_T_HIGH;
- P_T_HIGH > +1000;
- толщина стенки І 0;
- длина І 0 или больше максимально допустимой (например, > 5000 мм, если такое ограничение задано ’‡).

**„ействиЯ:**
- ParamValue(i) сохранЯет исходное значение;
- ParamErrorCode(i) = 4.

---

## 5 С OVERLAP_ERROR

**Ћписание:**  
ѓраницы параметров пересекаютсЯ, что говорит о некорректной разметке WorkString.

**Џримеры:**
- P_MODEL захватил часть следующего сегмента;
- P_EX захватил одновременно куски двух соседних сегментов.

**€спользование:**
- чаще всего выставлЯетсЯ в функции финальной валидации, когда по всем ParamStart/ParamEnd проверЯетсЯ отсутствие пересечений.

---

## 6 С TOKEN_CONFLICT

**Ћписание:**
Ћбнаружена проблема с токенами:

- два разных параметра используют один и тот же номер токена;
- токен в WorkString не соответствует ожидаемому формату `#<n>_<ParamName(i)>%`;
- токен расположен в месте, где должен быть другой параметр.

**€спользование:**
- полезно при отладке ReplaceParam и общей схемы токенизации.

---

## 7 С NORMALIZE_ERROR

**Ћписание:**  
Ћшибка на этапе нормализации строки:

- строка после нормализации оказалась пустой;
- обнаружены недопустимые символы, которые невозможно корректно обработать;
- процесс нормализации завершилсЯ с внутренней ошибкой (например, в RegExp).

---

## 127 С UNKNOWN_FRAGMENT

**Ћписание:**  
Џосле выполнениЯ всех функций P_XXX в WorkString остались фрагменты текста, которые:

- не ЯвлЯютсЯ токенами,
- не ЯвлЯютсЯ допустимыми разделителЯми,
- не описаны в Grammar.md.

**Ќазначение:**
- сигнал о том, что строка содержит лишние, неучтЮнные или новые элементы;
- может использоватьсЯ длЯ отбраковки или длЯ последующей ручной проверки.

---

## 255 С INTERNAL_ERROR

**Ћписание:**  
‚нутреннЯЯ ошибка парсера.

**Џримеры:**
- ошибка в логике обработки массивов Param*;
- выход за пределы индексов;
- критическаЯ ошибка в регулЯрном выражении;
- недопустимаЯ комбинациЯ состоЯний.

**ђекомендациЯ:**
- использовать только длЯ действительно неожиданных ситуаций;
- при отладке желательно по возможности заменЯть INTERNAL_ERROR на более конкретные коды (2, 4, 5, 6, 7, 127), если причина Ясна.

---

## ђекомендации по использованию кодов

1. ЉаждаЯ функциЯ P_XXX:
   - должна в начале устанавливать `ParamErrorCode(i) = 0`;
   - по результату:
     - при успехе С вернуть 0,
     - при проблеме С установить соответствующий код и вернуть его.

2. ѓлавнаЯ функциЯ PARSER:
   - имеет право остановить дальнейший парсинг при первой критической ошибке (по ’‡),
   - либо продолжить (режим "собрать максимум информации об ошибках") С этот режим определЯетсЯ архитектурой проекта.

3. ‚ отладке по Debug.Print рекомендуетсЯ выводить:
   - имЯ параметра,
   - найденное значение,
   - ParamStart/ParamEnd,
   - ParamErrorCode(i),
   - WorkString до и после замены.
