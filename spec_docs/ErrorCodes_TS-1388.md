# Error Codes for TS-1388 Parser (Excel VBA 2016)
Версия: 2025-12-17 (сверено с `Parser_TS-1388_Module_PARSER.bas`)

Этот документ описывает:
1) **коды состояния параметра** `ParamErrorCode(i)` (внутренний “жизненный цикл” параметров 1..20),
2) **возвращаемые коды функции** `Parser()` (итоговый статус разбора строки).

---

## 1) ParamErrorCode(i): коды состояния параметра

Эти значения используются **для каждого** параметра `i` (1..20).

| Код | Имя | Смысл |
|---:|---|---|
| 0 | `ERR_OK` | Параметр найден, значение очищено и участок строки заменён токеном (`ReplaceParam` выполнен). |
| 255 | `ERR_FOUND_NOT_CLEANED` | Параметр найден (заполнены `ParamValue/Start/End`), но ещё не токенизирован. Следующий шаг — `ReplaceParam i`. |
| 127 | `ERR_NOT_DEFINED` | Параметр обязателен, но не найден/невалиден (критическая ошибка для данного шага). |

### Нормативный порядок установки `ParamErrorCode(i)`
1) До поиска параметра: рекомендуется `ParamErrorCode(i)=127`, `Start/End=0`, `Value=""`.  
2) После успешного `Find_*`: `ParamErrorCode(i)=255`, заполнить `Value/Start/End`.  
3) После `ReplaceParam i`: `ParamErrorCode(i)=0`.

---

## 2) Parser(): возвращаемые коды (итог разбора)

`Parser()` возвращает **одно число**, которое используется как итоговый статус.

| Код | Смысл |
|---:|---|
| 0 | Разбор завершён успешно (все обязательные параметры обработаны). |
| 999 | Критическая внутренняя ошибка VBA (попадание в `ErrHandler`). |
| 101..119 | Ошибка на конкретном параметре: `100 + №параметра` (см. таблицу ниже). |
| 140 | Ошибка логики AES: для исполнения **без** `A` должен быть `KL_AES="-"`, но в своём сегменте `-` не найден. |
| 150 | Ошибка логики Ex: для исполнения **без** `EX/EXD` должен быть `EX="-"`, но в своём сегменте `-` не найден (т.е. “Ex-параметры указаны для не-Ex исполнения”). |

### 2.1 Таблица `100 + №параметра` (реально используемые коды)

| Код | Параметр | Имя в коде/ТЗ | Типовая причина |
|---:|---:|---|---|
| 101 | 1 | `P_TYPE` | Не найден `TC-1388` в начале и не удалось восстановить тип. |
| 102 | 2 | `P_ISPOLN` | Не определён вид исполнения. |
| 103 | 3 | `P_MODEL` | Не определён конструктив/модель. |
| 104 | 4 | `P_KL_AES` | Исполнение содержит `A`, но класс AES не найден. |
| 105 | 5 | `P_EX` | Исполнение содержит `EX/EXD`, но маркировка Ex не найдена. |
| 106 | 6 | `P_HCX` | Не определён НСХ/датчик (по справочнику). |
| 107 | 7/8 | `P_T_LOW/P_T_HIGH` | Не найден температурный диапазон. |
| 109 | 9 | `P_DLINA` | Длина/габарит не определены. |
| 110 | 10/11 | `P_DIAMETR/P_SHTUCER` | Диаметр и/или штуцер не определены в своём сегменте. |
| 112 | 12 | `P_L_KAB` | Не найдена длина кабеля. |
| 113 | 13 | `P_KABEL` | Не найден тип кабеля. |
| 114 | 14 | `P_KLASS` | Не найден класс точности. |
| 115 | 15 | `P_HEAD` | Не найдена головка. |
| 116 | 16 | `P_PLUG` | Не найдена заглушка/вставка. |
| 117 | 17 | `P_CXEMA` | Не найдена схема (N1..N6). |
| 118 | 18 | `P_GP` | Не найдено обозначение `GP` или `-` в своём сегменте. |
| 119 | 19 | `P_TU` | Не найдено ТУ (или `-`) в своём сегменте. |

Примечание:
- Параметр **#20 (H3)** в текущей реализации не возвращает отдельный код `120`, т.к. хвост допускается пустым/`-` и не считается фатальным (по месту).

---

## 3) Рекомендации по диагностике (Debug.Print)

Для воспроизводимости и регресса рекомендуется печатать на каждом шаге:
- индекс параметра и имя (`#i ParamName(i)`),
- найденное значение `ParamValue(i)`,
- диапазон `ParamStart/ParamEnd`,
- `ParamErrorCode(i)`,
- `WorkString` до/после `ReplaceParam` (в отладочном режиме).

---
